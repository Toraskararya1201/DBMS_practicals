Drop Table If Exists stud_marks;
Drop Table If Exists result;

Create Table stud_marks (
    roll_no Int,
    name Text,
    total_marks Int
);

Create Table result (
    roll_no Int,
    name Text,
    class Text
);

Insert Into stud_marks Values
(1, 'Ravi', 1200),
(2, 'Sneha', 950),
(3, 'Amit', 870);

CREATE OR REPLACE FUNCTION fn_grade(p_marks INT)
RETURNS TEXT
LANGUAGE plpgsql
AS $$
DECLARE
    v_class TEXT;
BEGIN
    IF p_marks >= 990 AND p_marks <= 1500 THEN
        v_class := 'Distinction';
    ELSIF p_marks >= 900 AND p_marks <= 989 THEN
        v_class := 'First Class';
    ELSIF p_marks >= 825 AND p_marks <= 899 THEN
        v_class := 'Higher Second Class';
    ELSE
        v_class := 'Fail';
    END IF;

    RETURN v_class;
END;
$$;

Create Or Replace Procedure proc_grade(p_roll Int)
Language plpgsql
As $$
Declare
    v_name Text;
    v_marks Int;
    v_class Text;
Begin
    -- Get student details
    Select name, total_marks
    Into v_name, v_marks
    From stud_marks
    Where roll_no = p_roll;

    -- Get class using stored function
    v_class := fn_grade(v_marks);

    Insert Into result Values (p_roll, v_name, v_class);
    Raise Notice '% -> %', v_name, v_class;
End;
$$;

Call proc_grade(1);
Call proc_grade(2);
Call proc_grade(3);

Select * From result;

